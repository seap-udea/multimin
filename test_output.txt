============================= test session starts ==============================
platform darwin -- Python 3.12.5, pytest-9.0.2, pluggy-1.6.0 -- /Users/jzuluaga/dev/multimin/.multimin/bin/python3.12
cachedir: .pytest_cache
rootdir: /Users/jzuluaga/dev/multimin
configfile: pytest.ini
plugins: cov-7.0.0
collecting ... collected 1 item

src/multimin/tests/test_core.py::test_cmnd_fitting FAILED                [100%]

=================================== FAILURES ===================================
______________________________ test_cmnd_fitting _______________________________

    def test_cmnd_fitting():
        """Test fitting a CMND with 2 Gaussians to generated data."""
        np.random.seed(1)
        deg = np.pi/180
        weights = [0.5, 0.5]
        mus = np.array([[1.0, 0.5, -0.5], [1.0, -0.5, +0.5]])
        sigmas = [[1, 1.2, 2.3], [0.8, 0.2, 3.3]]
        angles = [
            [10*deg, 30*deg, 20*deg],
            [-20*deg, 0*deg, 30*deg],
        ]
        Sigmas = mn.Stats.calc_covariance_from_rotation(sigmas, angles)
        # Correctly use weights based on updated signature
        CMND = mn.ComposedMultiVariateNormal(mus=mus, weights=weights, Sigmas=Sigmas)
    
        # Generate data
        n_samples = 2000 # Smaller sample for faster test
        data = CMND.rvs(n_samples)
    
        # Initialize fitter with correct number of gaussians (2) based on userrequest/notebook logic
        # The notebook example uses ngauss=2 for the true distribution and presumably for the fit
        F = mn.FitCMND(ngauss=2, nvars=3)
    
        # Run fit
        # advance=True is used in quickstart
        F.fit_data(data, advance=True)
    
        # Basic verification
        # Log likelihood should be reasonable (not infinite or NaN)
>       assert np.isfinite(F.log_l), "Log likelihood should be finite"
               ^^^^^^^^^^^^^^^^^^^^
E       TypeError: ufunc 'isfinite' not supported for the input types, and the inputs could not be safely coerced to any supported types according to the casting rule ''safe''

src/multimin/tests/test_core.py:172: TypeError
----------------------------- Captured stdout call -----------------------------
Iterations:
Iter 0:
	Vars: [0.5, 0.5, 1.4, 0.27, 0.32, 1.3, 0.24, 0.36, -2.1, -1.9, -0.55, -1.6, -1.2, -0.13, 1.7, 1.1, 0.58, 0.97, 1.5, 0.64]
	LogL/N: 5.793985003008144
Iter 1:
	Vars: [74, -0.52, 1.2, -0.1, 0.64, 0.7, 0.75, -0.49, -2, -2.6, -0.71, -1.8, -1.3, -1, 1.1, 0.49, 0.025, 0.61, 1.1, -0.31]
	LogL/N: 5.3680313075739345
Iter 2:
	Vars: [74, -0.21, 1.3, -0.35, 0.6, 0.81, 0.79, -0.65, -2.3, -3.3, -0.75, -1.9, -1.5, -1.2, 1.1, 0.0059, -0.11, -0.17, 0.34, -1.3]
	LogL/N: 5.053998917674718
Iter 3:
	Vars: [74, 1.3, 1.2, -0.46, 0.61, 0.91, 0.61, -0.56, -2.4, -3.6, -0.73, -2.2, -1.7, -1.3, 1.2, -0.069, -0.045, -0.47, 0.31, -1.2]
	LogL/N: 4.920552284378306
Iter 4:
	Vars: [74, 3.7, 1.1, -0.49, 0.68, 0.95, 0.49, -0.5, -2.4, -3.7, -0.7, -2.2, -1.7, -1.3, 1.2, -0.026, -0.00064, -0.46, 0.29, -1.1]
	LogL/N: 4.901827904073217
Iter 5:
	Vars: [74, 77, 1, -0.5, 0.7, 0.98, 0.45, -0.47, -2.4, -3.7, -0.69, -2.2, -1.7, -1.4, 1.2, 0.00086, 0.017, -0.45, 0.28, -1.1]
	LogL/N: 4.899721483839034
Iter 6:
	Vars: [74, 77, 1, -0.5, 0.71, 0.98, 0.44, -0.47, -2.5, -3.7, -0.69, -2.2, -1.7, -1.4, 1.2, 0.012, 0.023, -0.45, 0.27, -1.1]
	LogL/N: 4.89949603525502
Iter 7:
	Vars: [74, 77, 1, -0.5, 0.71, 0.98, 0.44, -0.47, -2.5, -3.7, -0.69, -2.2, -1.7, -1.4, 1.2, 0.012, 0.023, -0.45, 0.27, -1.1]
	LogL/N: 4.89949603525502
=============================== warnings summary ===============================
src/multimin/tests/test_core.py::test_cmnd_fitting
  /Users/jzuluaga/dev/multimin/src/multimin/__init__.py:1556: RuntimeWarning: divide by zero encountered in log
    log_l = -np.log(self.pdf(data)).sum()

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED src/multimin/tests/test_core.py::test_cmnd_fitting - TypeError: ufunc ...
========================= 1 failed, 1 warning in 1.70s =========================
